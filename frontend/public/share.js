(()=>{function b64u(s){return btoa(unescape(encodeURIComponent(s))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function ub64u(s){return decodeURIComponent(escape(atob(s.replace(/-/g,"+").replace(/_/g,"/"))))}function inputs(){return Array.from(document.querySelectorAll("input:not([type=hidden]), textarea"))}function snapshot(){return inputs().map(el=>({v:el.value??""}))}function restore(arr){const list=inputs();arr.forEach((d,i)=>{if(list[i]){list[i].value=d.v;list[i].dispatchEvent(new Event("input",{bubbles:!0}))}})}function mkUrl(){const q=new URLSearchParams(location.search);q.set("d",b64u(JSON.stringify(snapshot())));return location.origin+location.pathname+"?"+q.toString()+location.hash}function addBtn(){if(document.getElementById("share-copy-btn"))return;const b=document.createElement("button");b.id="share-copy-btn";b.textContent="Copy share link";Object.assign(b.style,{position:"fixed",right:"16px",bottom:"16px",zIndex:9999,padding:"10px 12px",borderRadius:"10px",boxShadow:"0 2px 8px rgba(0,0,0,.15)",background:"#111827",color:"#fff",border:"none",cursor:"pointer",opacity:"0.9"});b.onmouseenter=()=>b.style.opacity="1";b.onmouseleave=()=>b.style.opacity="0.9";b.addEventListener("click",async()=>{try{const url=mkUrl();await navigator.clipboard.writeText(url);b.textContent="Link copied âœ”";setTimeout(()=>b.textContent="Copy share link",1500)}catch(e){alert(mkUrl())}});document.body.appendChild(b)}function tryPrefill(){const u=new URL(location.href),d=u.searchParams.get("d");if(d)try{const a=JSON.parse(ub64u(d));Array.isArray(a)&&restore(a)}catch{}}window.addEventListener("load",()=>{addBtn(),tryPrefill()})})();
